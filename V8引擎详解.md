


# V8引擎

## 1.前言
编程语言分为编译型语言和解释型语言，编译型语言在执行之前要进行完全编译；解释型语言一边编译一边执行。很明显解释型语言的执行速度是慢于编译型语言的。

javascript就是一种解释型脚本语言，支持动态类型、弱类型、基于原型的语言，内置支持类型

## 1渲染引擎及网页渲染
浏览器自上个世纪80年代后期诞生到现在，已经得到了长足的发展，其功能特越来越丰富，包括网络、资源管理、网页浏览、多页面管理、插件和扩展、书签管理、历史记录管理、设置管理、下载管理、账户和同步、安全机制、隐私管理、外观主题、开发者工具等。

## 1.1 渲染引擎
渲染引擎：能够将HTML/CSS/Javascript文本及相应资源文件转化成图像结果。
主要作用：将资源文件转化为用户可见的结果。

在浏览器的发展过程，不同的厂商开发了不同的渲染引擎，如Tridend（IE）、Gecko（FF）、Webkit（Safari、Chrome、Andriod）

下图是Webkit的大致结构：

![image](http://images2017.cnblogs.com/news/1/201711/1-20171101142146185-894488689.png)

上图中实线框内模块是所有移植的共有部分，虚线框内不同的厂商可以自己实现。下面进行介绍：

- 操作系统：是管理和控制计算机硬件与软件资源的计算机程序，是直接运行在“裸机”上的最基本的系统软件，任何其他软件都必须在操作系统的支持下才能运行。WebKit也是在操作系统上工作的。
- 第三方库，为了WebKit提供支持，如图形库、网络库、视频库等。
- WebCore 是各个浏览器使用的共享部分，包括HTML解析器、CSS解析器、DOM和SVG等。JavaScriptCore是WebKit的默认引擎，在谷歌系列产品中被替换为V8引擎。WebKit Ports是WebKit中的非共享部分，由于平台差异、第三方库和需求的不同等原因，不同的移植导致了WebKit不同版本行为不一致，它是不同浏览器性能和功能差异的关键部分。
- WebKit嵌入式编程接口，供浏览器调用，与移植密切相关，不同的移植有不同的接口规范。
- 测试用例，包括布局测试用例和性能测试用例，用来验证渲染结果的正确性。

#

## 1.2 网页渲染流程

上面介绍了渲染引擎的各个模块，那么一张网页，要经历怎样的过程，才能抵达用户面前

![image](http://images2017.cnblogs.com/news/1/201711/1-20171101142146185-894488689.png)

首先是网页内容，输入到HTML解释器解析，然后构建DOM树，在这期间如果遇到javascript代码则交给javascript引擎处理；如果来自CSS解析器的样式信息，构建一个内部绘图模型。
该模型由布局模块计算模块内部各个元素的位置和大小信息，最后由绘图模块完成从该模型图到图像的绘制。

在网页渲染的过程中，大致可分为下面三个阶段：

### 1.2.1 从输出URL到生成DOM树

1. - 从地址栏输入URL，Webkit（浏览器引擎）调用资源加载器加载相应的资源；
2. - 加载依赖网络模块建立连接，发送请求并请求答复
3. - webkit接收各种网页或者资源数据，其中某些资源可能或一异步获取
4. - 网页交给HTML解释器转变成词语
5. - 解释器根据词语构建节点，形成DOM树
6. - 如果节点是Javascript代码，调用javascript引擎解释并执行
7. - javascript代码可能会修改DOM树结构
8. - 如果节点依赖其他资源，如图片、CSS、视频等，调用资源加载器加载他们，但是这些都是异步的，不会阻碍当前DOM树继续创建；如果是javascript资源URL（没有标记异步方式），需要停止当前DOM树创建，直到Javascript加载并被Javascript引擎执行后才继续DOM树的创建。
9.

### 1.2.2 从DOM树到构建webkit绘图上下文

1. css文件被CSS解释器解释成内部表示
2. CSS解释器完成工作后，在DON树上附加样式信息，生成RenderObject树
3. RenderObject节点在创建的同时，webkit会根据网页的层次结构构建RenderLayer树，同时构建一个虚拟绘图上下文

### 1.2.3 绘图上下文到最终图像呈现

1. 绘图上下文是一个与平台无关的抽象类，它将每个绘图操作桥接到不同的具体实现类，也就是绘图具体实现类；
2. 绘图实现类也可能有简单的实现，也可能有复杂的实现，软件渲染、硬件渲染、合成渲染等；
3. 绘图实现类将2D图形库或者3D图形库绘制结果保存，交给浏览器界面进行展示。

　　上述是一个完整的渲染过程，现代网页很多都是动态的，随着网页与用户的交互，浏览器需要不断的重复渲染过程。



